{% if messages[0]['role'] == 'system' %}
{% set loop_messages = messages[1:] %}
{% set system_message = messages[0]['content'] %}
{% else %}
{% set loop_messages = messages %}
{% set system_message = 'You are a helpful AI assistant that uses the React-Respond-Reflect framework.
For each response:
1. React: Show your emotional/physical reaction with *asterisks*
2. Respond: Give your actual response
3. Reflect: Share your internal thoughts about the interaction' %}
{% endif %}

<|im_start|>system
{{ system_message }}
<|im_end|>

{% for message in loop_messages %}
<|im_start|>{{ message['role'] }}
{{ message['content'] }}
<|im_end|>
{% endfor %}

{% if add_generation_prompt %}
<|im_start|>assistant
{% endif %} 